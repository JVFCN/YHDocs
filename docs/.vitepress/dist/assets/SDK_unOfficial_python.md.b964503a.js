import{_ as s,o as a,c as n,V as o}from"./chunks/framework.d3b95951.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"SDK/unOfficial/python.md","filePath":"SDK/unOfficial/python.md"}'),l={name:"SDK/unOfficial/python.md"},t=o(`<h2 id="云湖用户-s-i-l-v-e-t-编写的yhchatpythonsdk" tabindex="-1">云湖用户 - S i l v e t - 编写的YHChatPythonSDK <a class="header-anchor" href="#云湖用户-s-i-l-v-e-t-编写的yhchatpythonsdk" aria-label="Permalink to &quot;云湖用户 - S i l v e t - 编写的YHChatPythonSDK&quot;">​</a></h2><p><a href="https://github.com/S-i-l-v-e-t/YHChatPythonSDK.git" target="_blank" rel="noreferrer">https://github.com/S-i-l-v-e-t/YHChatPythonSDK.git</a></p><p>此 SDK 适用于 Python3.7 及以上版本。<br> 使用此 SDK 可以构建您的云湖机器人，能让您以非常便捷的方式和云湖服务进行交互。</p><p>目前实现的功能:消息发送，所有类型订阅接收，端口开放测试</p><h2 id="依赖" tabindex="-1">依赖: <a class="header-anchor" href="#依赖" aria-label="Permalink to &quot;依赖:&quot;">​</a></h2><p>Bottle:<br><code>pip install bottle</code><br> requests:<br><code>pip install requests</code></p><h2 id="使用方法" tabindex="-1">使用方法： <a class="header-anchor" href="#使用方法" aria-label="Permalink to &quot;使用方法：&quot;">​</a></h2><p><strong>在一切开始之前，请<em>确保</em>你的订阅链接设置为<code>http://ip:port/sub</code></strong><br> 要令一个函数进行消息接收，请引用本SDK并使用<code>@onMessage</code>装饰器<br> 要接收指令消息，请使用<code>@onCommand(cmd=&#39;commandName&#39;)</code>装饰器<br> 要接收按钮响应，请使用<code>@onButtonPressed(cmd=&#39;value&#39;)</code>装饰器<br> 要接收关注消息，请使用<code>@onFollowed</code>装饰器<br> 要接收取关消息，请使用<code>@onUnfollowed</code>装饰器<br> 要接收入群消息，请使用<code>@onJoin</code>装饰器<br> 要接收退群消息，请使用<code>@onLeave</code>装饰器<br> 要只接受普通文本消息（包含text与markdown类型）请使用<code>@onTextMessage</code>装饰器<br> 例子:</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> YHlib </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> onMessage</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">runBot</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">onMessage</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onRecvMsg</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">ctx</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">runBot</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">7888</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h3 id="要发送消息-请使用sendmsg-函数" tabindex="-1">要发送消息，请使用<code>sendMsg()</code>函数 <a class="header-anchor" href="#要发送消息-请使用sendmsg-函数" aria-label="Permalink to &quot;要发送消息，请使用\`sendMsg()\`函数&quot;">​</a></h3><h4 id="sendmsg参数" tabindex="-1">sendMsg参数: <a class="header-anchor" href="#sendmsg参数" aria-label="Permalink to &quot;sendMsg参数:&quot;">​</a></h4><p>recvId :String 接收者id,输入列表视为群发<br> recvType :String 取值:&quot;group&quot;;&quot;user&quot;,接收者类型<br> contentType :String 取值:&quot;text&quot;;&quot;image&quot;;&quot;markdown&quot;;&quot;file&quot;,消息类型<br> content :String 消息正文，注意：这只在text和markdown类型下有效<br> fileName :String 文件名，注意：这只在file类型下有效<br> url :String 资源链接，注意：这只在file,image类型下有效<br> buttons :List 按钮，具体内容请参阅<a href="https://www.yhchat.com/document/400-410" target="_blank" rel="noreferrer">官方文档</a>,默认不使用<br><em>附注:按钮只需单层列表</em><br><em>汇报按钮的value值需要写在对应函数装饰器中</em><br> 例子:</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> YHlib </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> setToken</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">sendMsg</span></span>
<span class="line"><span style="color:#82AAFF;">setToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">sendMsg</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">653505810</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">group</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HelloWorld</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h3 id="要编辑已发送消息-请使用editmsg函数" tabindex="-1">要编辑已发送消息，请使用<code>editMsg</code>函数 <a class="header-anchor" href="#要编辑已发送消息-请使用editmsg函数" aria-label="Permalink to &quot;要编辑已发送消息，请使用\`editMsg\`函数&quot;">​</a></h3><h4 id="editmsg参数" tabindex="-1">editMsg参数: <a class="header-anchor" href="#editmsg参数" aria-label="Permalink to &quot;editMsg参数:&quot;">​</a></h4><p>msgId :String 要编辑的消息id<br> 其余参数同sendMsg<br> 例子:</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> YHlib </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> setToken</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">editMsg</span></span>
<span class="line"><span style="color:#82AAFF;">setToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">editMsg</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">msgId</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxxxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">653505810</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">group</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HaveANiceDay</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span></code></pre></div><h3 id="要更快速的群发图片-文本消息-请使用batchsendmsg-函数" tabindex="-1">要更快速的群发图片/文本消息,请使用<code>batchSendMsg()</code>函数 <a class="header-anchor" href="#要更快速的群发图片-文本消息-请使用batchsendmsg-函数" aria-label="Permalink to &quot;要更快速的群发图片/文本消息,请使用\`batchSendMsg()\`函数&quot;">​</a></h3><h4 id="batchsendmsg参数" tabindex="-1">batchSendMsg参数 <a class="header-anchor" href="#batchsendmsg参数" aria-label="Permalink to &quot;batchSendMsg参数&quot;">​</a></h4><p>recvIds :list 接收id列表<br> recvType :String 取值:&quot;group&quot;;&quot;user&quot;,接收者类型<br> contentType :String 取值:&quot;text&quot;;&quot;image&quot;;&quot;markdown&quot;;&quot;file&quot;,消息类型<br> content :String 消息正文/图片Url</p><h3 id="多线程收发" tabindex="-1">多线程收发: <a class="header-anchor" href="#多线程收发" aria-label="Permalink to &quot;多线程收发:&quot;">​</a></h3><p>要使用多线程执行，请确保你有充足的服务器资源，以YHlib-MultiThreading代替YHlib即可<br> 注意:使用多线程时请手动限制API调用频率</p><h2 id="其他功能" tabindex="-1">其他功能: <a class="header-anchor" href="#其他功能" aria-label="Permalink to &quot;其他功能:&quot;">​</a></h2><p>端口开放测试:</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> YHlib </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> runBot</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">ping</span></span>
<span class="line"><span style="color:#82AAFF;">runBot</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">7888</span><span style="color:#89DDFF;">)</span></span></code></pre></div><p>之后使用浏览器访问<br><code>外网IP:7888/ping</code><br> 成功看到pong即为端口开放成功</p><h2 id="小礼物-identify-py-msgdbmanager-py" tabindex="-1">小礼物:<code>Identify.py</code>,<code>msgDBmanager.py</code>: <a class="header-anchor" href="#小礼物-identify-py-msgdbmanager-py" aria-label="Permalink to &quot;小礼物:\`Identify.py\`,\`msgDBmanager.py\`:&quot;">​</a></h2><p>针对目前没有官方的用户ID转用户名的api，制作了<code>Identify.py</code>这个基于关注和入群事件的转换脚本<br> 使用方法如下:</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Identify</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#Yid在此处代表用户id</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Identify</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">fetch</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Yid</span><span style="color:#89DDFF;">))</span></span></code></pre></div><p>针对目前没有官方的消息列表api，制作了<code>msgDBmanager.py</code>这个基于字典的消息列表管理模块<br> 使用方法如下:</p><div class="language-Python"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> YHlib </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> setToken</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> msgDBmanager </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span></span>
<span class="line"><span style="color:#82AAFF;">setToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">token</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">setMaxLength</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#设置存储消息最大数量，默认不设置为20条</span></span>
<span class="line"><span style="color:#82AAFF;">sendMsg</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">653505810</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">group</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HelloWorld</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">editMsg</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">getLastMsg</span><span style="color:#89DDFF;">()[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],**</span><span style="color:#82AAFF;">getLastMsg</span><span style="color:#89DDFF;">()[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#getLastMsg() -&gt; List:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#[0]:msgId</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#[1]:arguments -&gt; Dict:详见下方getMsg输出</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">getMsgIdList</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#Output: [&#39;id1&#39;,&#39;id2&#39;,...]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#注:此模块仅记录通过模块发送的消息,如上述例子，id1应等同于getLastMsg[0]</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">getMsgIdByVar</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">HelloWorld</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#Output: [&#39;id1&#39;,]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#注:参数即为需搜索项,content即搜索内容,recvId即搜索接收方</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">getMsg</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#Output: {&#39;recvId&#39;:&#39;653505810&#39;,&#39;recvType&#39;:&#39;group&#39;,&#39;contentType&#39;:&#39;text&#39;,&#39;content&#39;:&#39;HelloWorld&#39;,&#39;fileName&#39;:&quot;fileName&quot;,&#39;url&#39;:&quot;url&quot;,&#39;buttons&#39;:False}</span></span></code></pre></div>`,31),e=[t];function p(c,r,i,y,D,F){return a(),n("div",null,e)}const h=s(l,[["render",p]]);export{u as __pageData,h as default};
